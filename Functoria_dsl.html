<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<link rel="stylesheet" href="style.css" type="text/css">
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<link rel="Start" href="index.html">
<link rel="previous" href="Functoria_key.html">
<link rel="next" href="Functoria_runtime.html">
<link rel="Up" href="index.html">
<link title="Index of types" rel=Appendix href="index_types.html">
<link title="Index of exceptions" rel=Appendix href="index_exceptions.html">
<link title="Index of values" rel=Appendix href="index_values.html">
<link title="Index of class methods" rel=Appendix href="index_methods.html">
<link title="Index of classes" rel=Appendix href="index_classes.html">
<link title="Index of class types" rel=Appendix href="index_class_types.html">
<link title="Index of modules" rel=Appendix href="index_modules.html">
<link title="Index of module types" rel=Appendix href="index_module_types.html">
<link title="Functoria" rel="Chapter" href="Functoria.html">
<link title="Functoria_misc" rel="Chapter" href="Functoria_misc.html">
<link title="Functoria_key" rel="Chapter" href="Functoria_key.html">
<link title="Functoria_dsl" rel="Chapter" href="Functoria_dsl.html">
<link title="Functoria_runtime" rel="Chapter" href="Functoria_runtime.html">
<link title="Functoria_info" rel="Chapter" href="Functoria_info.html"><link title="Combinators" rel="Section" href="#combinators">
<link title="Keys" rel="Section" href="#keys">
<link title="Application Builder" rel="Section" href="#app">
<link title="Sharing" rel="Section" href="#1_Sharing">
<title>Functoria : Functoria_dsl</title>
</head>
<body>
<div class="navbar"><a class="pre" href="Functoria_key.html" title="Functoria_key">Previous</a>
&nbsp;<a class="up" href="index.html" title="Index">Up</a>
&nbsp;<a class="post" href="Functoria_runtime.html" title="Functoria_runtime">Next</a>
</div>
<h1>Module <a href="type_Functoria_dsl.html">Functoria_dsl</a></h1>

<pre><span class="keyword">module</span> Functoria_dsl: <code class="code"><span class="keyword">sig</span></code> <a href="Functoria_dsl.html">..</a> <code class="code"><span class="keyword">end</span></code></pre><div class="info module top">
The Functoria DSL.
<p>

    The Functoria DSL allows users to describe how to create portable
    and flexible applications. It allows to pass application
    parameters easily using command-line arguments either at
    configure-time or at runtime.
<p>

    Users of the Functoria DSL composes their application by defining
    a list of <a href="Functoria_dsl.html#VALforeign">module</a> implementations, specify the
    command-line <a href="Functoria_dsl.html#keys"><i>Keys</i></a> that are required and <a href="Functoria_dsl.html#combinators">combine</a>
    all of them together using
    <a href="http://dx.doi.org/10.1017/S0956796807006326">applicative</a>
    operators.
<p>

    The DSL expression is then compiled into an <a href="Functoria_dsl.html#app">application
    builder</a>, which will, once evaluated, produced the final portable
    and flexible application.<br>
</div>
<hr width="100%">
<br>
<h1 id="combinators">Combinators</h1><br>

<pre><code><span id="TYPEtyp"><span class="keyword">type</span> <code class="type">'_</code> typ</span> = </code></pre><table class="typetable">
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTtyp.Type"><span class="constructor">Type</span></span> <span class="keyword">:</span> <code class="type">'a</code> <span class="keyword">-></span> <code class="type">'a <a href="Functoria_dsl.html#TYPEtyp">typ</a></code></code></td>

</tr>
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTtyp.Function"><span class="constructor">Function</span></span> <span class="keyword">:</span> <code class="type">'b <a href="Functoria_dsl.html#TYPEtyp">typ</a> * 'c <a href="Functoria_dsl.html#TYPEtyp">typ</a></code> <span class="keyword">-></span> <code class="type">('b -> 'c) <a href="Functoria_dsl.html#TYPEtyp">typ</a></code></code></td>

</tr></table>

<div class="info ">
The type for values representing module types.<br>
</div>


<pre><span id="VALtyp"><span class="keyword">val</span> typ</span> : <code class="type">'a -> 'a <a href="Functoria_dsl.html#TYPEtyp">typ</a></code></pre><div class="info ">
<code class="code"><span class="keyword">type</span> t</code> is a value representing the module type <code class="code">t</code>.<br>
</div>

<pre><span id="VAL(@->)"><span class="keyword">val</span> (@-&gt;)</span> : <code class="type">'a <a href="Functoria_dsl.html#TYPEtyp">typ</a> -> 'b <a href="Functoria_dsl.html#TYPEtyp">typ</a> -> ('a -> 'b) <a href="Functoria_dsl.html#TYPEtyp">typ</a></code></pre><div class="info ">
Construct a functor type from a type and an existing functor
    type. This corresponds to prepending a parameter to the list of
    functor parameters. For example:
<p>

    <pre class="codepre"><code class="code">&nbsp;kv_ro&nbsp;@-&gt;&nbsp;ip&nbsp;@-&gt;&nbsp;kv_ro&nbsp;</code></pre>
<p>

    This describes a functor type that accepts two arguments -- a
    <code class="code">kv_ro</code> and an <code class="code">ip</code> device -- and returns a <code class="code">kv_ro</code>.<br>
</div>

<pre><span id="TYPEjob"><span class="keyword">type</span> <code class="type"></code>job</span> </pre>
<div class="info ">
Type for job values.<br>
</div>


<pre><span id="VALjob"><span class="keyword">val</span> job</span> : <code class="type"><a href="Functoria_dsl.html#TYPEjob">job</a> <a href="Functoria_dsl.html#TYPEtyp">typ</a></code></pre><div class="info ">
<code class="code">jpb</code> is the signature for user's application main module.<br>
</div>

<pre><span id="TYPEimpl"><span class="keyword">type</span> <code class="type">'a</code> impl</span> </pre>
<div class="info ">
The type for values representing module implementations.<br>
</div>


<pre><span id="VAL($)"><span class="keyword">val</span> ($)</span> : <code class="type">('a -> 'b) <a href="Functoria_dsl.html#TYPEimpl">impl</a> -><br>       'a <a href="Functoria_dsl.html#TYPEimpl">impl</a> -> 'b <a href="Functoria_dsl.html#TYPEimpl">impl</a></code></pre><div class="info ">
<code class="code">m $ a</code> applies the functor <code class="code">m</code> to the module <code class="code">a</code>.<br>
</div>

<pre><code><span id="TYPEabstract_impl"><span class="keyword">type</span> <code class="type"></code>abstract_impl</span> = </code></pre><table class="typetable">
<tr>
<td align="left" valign="top" >
<code><span class="keyword">|</span></code></td>
<td align="left" valign="top" >
<code><span id="TYPEELTabstract_impl.Abstract"><span class="constructor">Abstract</span></span> <span class="keyword">:</span> <code class="type">'a <a href="Functoria_dsl.html#TYPEimpl">impl</a></code> <span class="keyword">-></span> <code class="type"><a href="Functoria_dsl.html#TYPEabstract_impl">abstract_impl</a></code></code></td>

</tr></table>

<div class="info ">
The type for abstract implementations.<br>
</div>


<pre><span id="VALabstract"><span class="keyword">val</span> abstract</span> : <code class="type">'a <a href="Functoria_dsl.html#TYPEimpl">impl</a> -> <a href="Functoria_dsl.html#TYPEabstract_impl">abstract_impl</a></code></pre><div class="info ">
<code class="code">abstract t</code> is <code class="code">t</code> but with its type variable abstracted. Useful
    for dependencies.<br>
</div>
<br>
<h1 id="keys">Keys</h1><br>

<pre><span class="keyword">module</span> <a href="Functoria_dsl.Key.html">Key</a>: <code class="type">module type of struct include <a href="Functoria_key.html">Functoria_key</a> end</code></pre><div class="info">
Key creation and manipulation.
</div>

<pre><span id="VALif_impl"><span class="keyword">val</span> if_impl</span> : <code class="type">bool Key.value -><br>       'a <a href="Functoria_dsl.html#TYPEimpl">impl</a> -> 'a <a href="Functoria_dsl.html#TYPEimpl">impl</a> -> 'a <a href="Functoria_dsl.html#TYPEimpl">impl</a></code></pre><div class="info ">
<code class="code">if_impl v impl1 impl2</code> is <code class="code">impl1</code> if <code class="code">v</code> is resolved to true and
    <code class="code">impl2</code> otherwise.<br>
</div>

<pre><span id="VALswitch"><span class="keyword">val</span> switch</span> : <code class="type">default:'a <a href="Functoria_dsl.html#TYPEimpl">impl</a> -><br>       ('b * 'a <a href="Functoria_dsl.html#TYPEimpl">impl</a>) list -><br>       'b Key.value -> 'a <a href="Functoria_dsl.html#TYPEimpl">impl</a></code></pre><div class="info ">
<code class="code">switch ~default cases v</code> choose the implementation amongst
    <code class="code">cases</code> by matching the <code class="code">v</code>'s value. <code class="code">default</code> is chosen if no
    value match.<br>
</div>
<br>
<h1 id="app">Application Builder</h1><br>

<pre><span id="VALforeign"><span class="keyword">val</span> foreign</span> : <code class="type">?packages:string list -><br>       ?libraries:string list -><br>       ?keys:Key.t list -><br>       ?dependencies:<a href="Functoria_dsl.html#TYPEabstract_impl">abstract_impl</a> list -><br>       string -> 'a <a href="Functoria_dsl.html#TYPEtyp">typ</a> -> 'a <a href="Functoria_dsl.html#TYPEimpl">impl</a></code></pre><div class="info ">
<code class="code">foreign name typ</code> is the module <code class="code">name</code>, having with the
    odule type <code class="code">typ</code>.
<p>

    <ul>
<li>If <code class="code">packages</code> is set, then the given OPAM packages are
       installed before compiling the current application.</li>
<li>If <code class="code">libraries</code> is set, the given OCamlfind libraries are
       included and linked with the module <code class="code">name</code>.</li>
<li>If <code class="code">keys</code> is set, use the given <a href="Functoria_key.html#TYPEkey">keys</a> to
       parse at configure and runtime the command-line arguments
       before calling <code class="code">name.connect</code>.</li>
<li>If <code class="code">dependencies</code> is set, the given list of
       <a href="Functoria_dsl.html#TYPEabstract_impl">abstract</a> implementations is added as
       data-dependencies: they will be initialized before calling
       <code class="code">name.connect</code>. </li>
</ul>
<br>
</div>

<pre><span class="keyword">module</span> <a href="Functoria_dsl.Info.html">Info</a>: <code class="code"><span class="keyword">sig</span></code> <a href="Functoria_dsl.Info.html">..</a> <code class="code"><span class="keyword">end</span></code></pre><div class="info">
Information about the final application.
</div>

<pre><span id="TYPEconfigurable"><span class="keyword">class type</span> <code class="type">['ty]</code> <a href="Functoria_dsl.configurable-c.html">configurable</a></span> = <code class="code"><span class="keyword">object</span></code> <a href="Functoria_dsl.configurable-c.html">..</a> <code class="code"><span class="keyword">end</span></code></pre><div class="info">
Signature for configurable module implementations.
</div>

<pre><span id="VALimpl"><span class="keyword">val</span> impl</span> : <code class="type">'a <a href="Functoria_dsl.configurable-c.html">configurable</a> -> 'a <a href="Functoria_dsl.html#TYPEimpl">impl</a></code></pre><div class="info ">
<code class="code">impl c</code> is the implementation of the configurable <code class="code">c</code>.<br>
</div>

<pre><span id="VALexplode"><span class="keyword">val</span> explode</span> : <code class="type">'a <a href="Functoria_dsl.html#TYPEimpl">impl</a> -><br>       [ `App of <a href="Functoria_dsl.html#TYPEabstract_impl">abstract_impl</a> * <a href="Functoria_dsl.html#TYPEabstract_impl">abstract_impl</a><br>       | `If of<br>           bool Key.value * 'a <a href="Functoria_dsl.html#TYPEimpl">impl</a> *<br>           'a <a href="Functoria_dsl.html#TYPEimpl">impl</a><br>       | `Impl of 'a <a href="Functoria_dsl.configurable-c.html">configurable</a> ]</code></pre><div class="info ">
<code class="code">explode i</code> inspects the contents of <code class="code">i</code>.<br>
</div>

<pre><span name="TYPEbase_configurable"><span class="keyword">class</span> <a href="Functoria_dsl.base_configurable-c.html">base_configurable</a></span> : <code class="type"></code><code class="code"><span class="keyword">object</span></code> <a href="Functoria_dsl.base_configurable-c.html">..</a> <code class="code"><span class="keyword">end</span></code></pre><div class="info">
<code class="code">base_configurable</code> pre-defining many methods from the
    <a href="Functoria_dsl.configurable-c.html"><code class="code"><span class="constructor">Functoria_dsl</span>.configurable</code></a> class.
</div>
<br>
<h1 id="1_Sharing">Sharing</h1><br>

<pre><span id="VALhash"><span class="keyword">val</span> hash</span> : <code class="type">'a <a href="Functoria_dsl.html#TYPEimpl">impl</a> -> int</code></pre><div class="info ">
<code class="code">hash</code> is the hash function on implementations. FIXME(samoht)
    expand on how it works.<br>
</div>

<pre><span id="VALequal"><span class="keyword">val</span> equal</span> : <code class="type">'a <a href="Functoria_dsl.html#TYPEimpl">impl</a> -> 'a <a href="Functoria_dsl.html#TYPEimpl">impl</a> -> bool</code></pre><div class="info ">
<code class="code">equal</code> is the equality over implementations.<br>
</div>

<pre><span class="keyword">module</span> <a href="Functoria_dsl.ImplTbl.html">ImplTbl</a>: <code class="type">Hashtbl.S</code><code class="type">  with type key = abstract_impl</code></pre><div class="info">
Hashtbl of implementations.
</div>
</body></html>